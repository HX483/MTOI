# 奶茶店订单制作与原料库存管理系统数据库设计文档

## 1. 数据库概述

### 1.1 数据库系统
- **数据库类型**: MySQL 8.0
- **字符集**: utf8mb4
- **校对规则**: utf8mb4_unicode_ci
- **存储引擎**: InnoDB

### 1.2 设计原则
- 遵循关系数据库设计范式
- 确保数据一致性和完整性
- 优化查询性能
- 考虑数据安全性

## 2. 系统管理相关表

### 2.1 sys_user (用户表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| user_id | bigint | PRIMARY KEY AUTO_INCREMENT | 用户ID |
| dept_id | bigint | FOREIGN KEY | 部门ID |
| username | varchar(50) | NOT NULL UNIQUE | 用户名 |
| password | varchar(255) | NOT NULL | 密码 |
| nickname | varchar(50) | NOT NULL | 昵称 |
| avatar | varchar(255) | | 头像 |
| email | varchar(100) | | 邮箱 |
| phone | varchar(20) | | 手机号 |
| sex | char(1) | DEFAULT '0' | 性别(0:男,1:女,2:未知) |
| status | tinyint | DEFAULT 1 | 状态(0:禁用,1:启用) |
| login_ip | varchar(50) | | 最后登录IP |
| login_date | datetime | | 最后登录时间 |
| create_by | varchar(64) | | 创建者 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_by | varchar(64) | | 更新者 |
| update_time | datetime | | 更新时间 |
| remark | varchar(500) | | 备注 |

### 2.2 sys_role (角色表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| role_id | bigint | PRIMARY KEY AUTO_INCREMENT | 角色ID |
| role_name | varchar(30) | NOT NULL UNIQUE | 角色名称 |
| role_key | varchar(100) | NOT NULL UNIQUE | 角色权限字符串 |
| role_sort | int | NOT NULL | 显示顺序 |
| data_scope | char(1) | DEFAULT '1' | 数据范围(1:全部数据权限,2:自定数据权限,3:本部门数据权限,4:本部门及以下数据权限) |
| status | tinyint | DEFAULT 1 | 状态(0:禁用,1:启用) |
| del_flag | char(1) | DEFAULT '0' | 删除标志(0:存在,2:删除) |
| create_by | varchar(64) | | 创建者 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_by | varchar(64) | | 更新者 |
| update_time | datetime | | 更新时间 |
| remark | varchar(500) | | 备注 |

### 2.3 sys_menu (菜单表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| menu_id | bigint | PRIMARY KEY AUTO_INCREMENT | 菜单ID |
| menu_name | varchar(50) | NOT NULL | 菜单名称 |
| parent_id | bigint | DEFAULT 0 | 父菜单ID |
| order_num | int | DEFAULT 0 | 显示顺序 |
| path | varchar(200) | | 路由地址 |
| component | varchar(255) | | 组件路径 |
| query | varchar(255) | | 路由参数 |
| is_frame | int | DEFAULT 1 | 是否为外链(0:是,1:否) |
| is_cache | int | DEFAULT 0 | 是否缓存(0:否,1:是) |
| menu_type | char(1) | | 菜单类型(M:目录,C:菜单,F:按钮) |
| visible | char(1) | DEFAULT '0' | 显示状态(0:显示,1:隐藏) |
| status | char(1) | DEFAULT '0' | 菜单状态(0:正常,1:停用) |
| perms | varchar(100) | | 权限标识 |
| icon | varchar(100) | DEFAULT '#', | 菜单图标 |
| create_by | varchar(64) | | 创建者 |
| create_time | datetime | | 创建时间 |
| update_by | varchar(64) | | 更新者 |
| update_time | datetime | | 更新时间 |
| remark | varchar(500) | | 备注 |

## 3. 产品相关表

### 3.1 product_category (产品分类表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| category_id | bigint | PRIMARY KEY AUTO_INCREMENT | 分类ID |
| category_name | varchar(50) | NOT NULL UNIQUE | 分类名称 |
| parent_id | bigint | DEFAULT 0 | 父分类ID |
| order_num | int | DEFAULT 0 | 显示顺序 |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

### 3.2 product_info (产品信息表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| product_id | bigint | PRIMARY KEY AUTO_INCREMENT | 产品ID |
| product_name | varchar(100) | NOT NULL UNIQUE | 产品名称 |
| category_id | bigint | FOREIGN KEY | 分类ID |
| price | decimal(10,2) | NOT NULL | 价格 |
| description | varchar(500) | | 产品描述 |
| image_url | varchar(255) | | 产品图片 |
| is_hot | tinyint | DEFAULT 0 | 是否热销(1:是,0:否) |
| is_new | tinyint | DEFAULT 0 | 是否新品(1:是,0:否) |
| status | tinyint | DEFAULT 1 | 状态(1:上架,0:下架) |
| create_by | varchar(64) | | 创建者 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_by | varchar(64) | | 更新者 |
| update_time | datetime | | 更新时间 |

### 3.3 product_formula (产品配方表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| formula_id | bigint | PRIMARY KEY AUTO_INCREMENT | 配方ID |
| product_id | bigint | FOREIGN KEY | 产品ID |
| material_id | bigint | FOREIGN KEY | 原料ID |
| quantity | decimal(10,4) | NOT NULL | 用量 |
| unit | varchar(20) | NOT NULL | 单位 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

### 3.4 product_attribute (产品属性表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| attribute_id | bigint | PRIMARY KEY AUTO_INCREMENT | 属性ID |
| attribute_name | varchar(50) | NOT NULL | 属性名称 |
| attribute_value | varchar(255) | NOT NULL | 属性值(JSON格式) |
| product_id | bigint | FOREIGN KEY | 产品ID |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

## 4. 原料库存相关表

### 4.1 material_category (原料分类表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| category_id | bigint | PRIMARY KEY AUTO_INCREMENT | 分类ID |
| category_name | varchar(50) | NOT NULL UNIQUE | 分类名称 |
| parent_id | bigint | DEFAULT 0 | 父分类ID |
| order_num | int | DEFAULT 0 | 显示顺序 |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

### 4.2 material_info (原料信息表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| material_id | bigint | PRIMARY KEY AUTO_INCREMENT | 原料ID |
| material_name | varchar(100) | NOT NULL | 原料名称 |
| category_id | bigint | FOREIGN KEY | 分类ID |
| specification | varchar(100) | | 规格 |
| unit | varchar(20) | NOT NULL | 单位 |
| supplier_id | bigint | FOREIGN KEY | 供应商ID |
| purchase_price | decimal(10,4) | | 采购单价 |
| shelf_life | int | | 保质期(天) |
| warning_days | int | DEFAULT 7 | 预警天数 |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |
| create_by | varchar(64) | | 创建者 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_by | varchar(64) | | 更新者 |
| update_time | datetime | | 更新时间 |

### 4.3 stock_info (库存信息表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| stock_id | bigint | PRIMARY KEY AUTO_INCREMENT | 库存ID |
| material_id | bigint | UNIQUE NOT NULL FOREIGN KEY | 原料ID |
| quantity | decimal(15,4) | NOT NULL DEFAULT 0 | 库存数量 |
| alert_threshold | decimal(15,4) | NOT NULL DEFAULT 0 | 预警阈值 |
| warehouse_id | bigint | FOREIGN KEY | 仓库ID |
| location | varchar(100) | | 存储位置 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | NOT NULL | 更新时间 |

### 4.4 stock_record (库存变动记录表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| record_id | bigint | PRIMARY KEY AUTO_INCREMENT | 记录ID |
| material_id | bigint | NOT NULL FOREIGN KEY | 原料ID |
| type | tinyint | NOT NULL | 变动类型(1:入库,2:出库,3:盘点,4:报损) |
| quantity | decimal(15,4) | NOT NULL | 变动数量 |
| before_quantity | decimal(15,4) | NOT NULL | 变动前数量 |
| after_quantity | decimal(15,4) | NOT NULL | 变动后数量 |
| order_id | bigint | | 关联订单ID |
| reference_no | varchar(50) | | 参考单号 |
| operator_id | bigint | | 操作人ID |
| remark | varchar(500) | | 备注 |
| create_time | datetime | NOT NULL | 创建时间 |

### 4.5 warehouse (仓库表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| warehouse_id | bigint | PRIMARY KEY AUTO_INCREMENT | 仓库ID |
| warehouse_name | varchar(100) | NOT NULL UNIQUE | 仓库名称 |
| address | varchar(255) | | 仓库地址 |
| manager_id | bigint | | 负责人ID |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

### 4.6 supplier (供应商表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| supplier_id | bigint | PRIMARY KEY AUTO_INCREMENT | 供应商ID |
| supplier_name | varchar(100) | NOT NULL | 供应商名称 |
| contact_person | varchar(50) | | 联系人 |
| contact_phone | varchar(20) | | 联系电话 |
| email | varchar(100) | | 邮箱 |
| address | varchar(255) | | 地址 |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

## 5. 订单相关表

### 5.1 order_main (订单主表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| order_id | bigint | PRIMARY KEY AUTO_INCREMENT | 订单ID |
| order_no | varchar(50) | UNIQUE NOT NULL | 订单编号 |
| customer_id | bigint | | 顾客ID |
| customer_name | varchar(50) | NOT NULL | 顾客姓名 |
| customer_phone | varchar(20) | NOT NULL | 顾客电话 |
| total_amount | decimal(10,2) | NOT NULL | 总金额 |
| actual_amount | decimal(10,2) | NOT NULL | 实际支付金额 |
| discount_amount | decimal(10,2) | DEFAULT 0 | 优惠金额 |
| order_type | tinyint | NOT NULL | 订单类型(1:堂食,2:外卖,3:自提) |
| status | tinyint | NOT NULL | 订单状态(1:待支付,2:待制作,3:制作中,4:待配送,5:配送中,6:已完成,7:已取消) |
| payment_status | tinyint | NOT NULL | 支付状态(0:未支付,1:已支付,2:支付失败,3:退款中,4:已退款) |
| payment_type | tinyint | | 支付方式(1:微信,2:支付宝,3:现金) |
| table_no | varchar(20) | | 桌号(堂食) |
| delivery_address | varchar(500) | | 配送地址 |
| remark | varchar(500) | | 备注 |
| operator_id | bigint | | 操作人ID |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | NOT NULL | 更新时间 |
| payment_time | datetime | | 支付时间 |
| completion_time | datetime | | 完成时间 |

### 5.2 order_detail (订单明细表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| detail_id | bigint | PRIMARY KEY AUTO_INCREMENT | 详情ID |
| order_id | bigint | NOT NULL FOREIGN KEY | 订单ID |
| product_id | bigint | NOT NULL FOREIGN KEY | 产品ID |
| product_name | varchar(100) | NOT NULL | 产品名称 |
| quantity | int | NOT NULL | 数量 |
| price | decimal(10,2) | NOT NULL | 单价 |
| subtotal | decimal(10,2) | NOT NULL | 小计 |
| customization | varchar(500) | | 定制要求 |
| create_time | datetime | NOT NULL | 创建时间 |

### 5.3 order_status_history (订单状态历史表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| history_id | bigint | PRIMARY KEY AUTO_INCREMENT | 历史ID |
| order_id | bigint | NOT NULL FOREIGN KEY | 订单ID |
| old_status | tinyint | NOT NULL | 原状态 |
| new_status | tinyint | NOT NULL | 新状态 |
| operator_id | bigint | | 操作人ID |
| remark | varchar(500) | | 备注 |
| create_time | datetime | NOT NULL | 创建时间 |

### 5.4 customer (顾客表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| customer_id | bigint | PRIMARY KEY AUTO_INCREMENT | 顾客ID |
| customer_name | varchar(50) | | 顾客姓名 |
| phone | varchar(20) | UNIQUE | 手机号码 |
| avatar | varchar(255) | | 头像 |
| member_level | tinyint | DEFAULT 1 | 会员等级 |
| points | int | DEFAULT 0 | 积分 |
| total_consume | decimal(10,2) | DEFAULT 0 | 总消费金额 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

## 6. 采购相关表

### 6.1 purchase_order (采购订单表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| purchase_id | bigint | PRIMARY KEY AUTO_INCREMENT | 采购订单ID |
| purchase_no | varchar(50) | UNIQUE NOT NULL | 采购单号 |
| supplier_id | bigint | NOT NULL FOREIGN KEY | 供应商ID |
| total_amount | decimal(10,2) | NOT NULL | 总金额 |
| status | tinyint | NOT NULL | 状态(1:待审核,2:已审核,3:采购中,4:已完成,5:已取消) |
| remark | varchar(500) | | 备注 |
| creator_id | bigint | | 创建人ID |
| auditor_id | bigint | | 审核人ID |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |
| audit_time | datetime | | 审核时间 |
| completion_time | datetime | | 完成时间 |

### 6.2 purchase_detail (采购明细表)
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| detail_id | bigint | PRIMARY KEY AUTO_INCREMENT | 详情ID |
| purchase_id | bigint | NOT NULL FOREIGN KEY | 采购订单ID |
| material_id | bigint | NOT NULL FOREIGN KEY | 原料ID |
| material_name | varchar(100) | NOT NULL | 原料名称 |
| specification | varchar(100) | | 规格 |
| unit | varchar(20) | NOT NULL | 单位 |
| quantity | decimal(15,4) | NOT NULL | 采购数量 |
| unit_price | decimal(10,4) | NOT NULL | 单价 |
| amount | decimal(10,2) | NOT NULL | 金额 |
| actual_quantity | decimal(15,4) | | 实际到货数量 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | | 更新时间 |

## 7. 索引设计

### 7.1 主键索引
- 所有表的主键字段均建立主键索引

### 7.2 唯一索引
- order_main表的order_no字段
- product_info表的product_name字段
- material_info表的material_name字段
- user表的username字段
- customer表的phone字段

### 7.3 普通索引
- order_main表的customer_id、create_time、status字段
- order_detail表的order_id、product_id字段
- stock_info表的material_id、warehouse_id字段
- stock_record表的material_id、create_time字段
- product_formula表的product_id、material_id字段
- purchase_order表的supplier_id、create_time、status字段

## 8. 数据完整性约束

### 8.1 主键约束
- 所有表必须有主键
- 主键字段使用自增长方式

### 8.2 外键约束
- 建立合理的外键关系，确保数据一致性
- 级联删除策略根据业务需求确定

### 8.3 非空约束
- 关键业务字段设置非空约束
- 如：产品名称、价格、订单号、顾客信息等

### 8.4 业务规则约束
- 库存数量不能为负数
- 订单状态变更必须符合业务流程
- 价格、金额字段使用decimal类型，确保精度

## 9. 数据库安全

### 9.1 用户权限管理
- 遵循最小权限原则
- 不同角色分配不同权限
- 定期审查权限设置

### 9.2 数据备份策略
- 每日增量备份
- 每周全量备份
- 备份数据异地存储

### 9.3 性能优化考虑
- 合理设计索引
- 优化查询语句
- 考虑分表分库策略（大数据量时）
- 使用连接池管理数据库连接