# 报表分析模块部署说明

## 一、模块说明

报表分析模块提供了以下功能：
- **综合仪表盘**：展示关键业务指标
- **库存统计**：总库存数量、价值、仓库统计等
- **库存预警**：显示库存不足的原料列表
- **盘点分析**：盘点总数、状态、差异统计
- **原料使用分析**：原料使用情况统计
- **产品分析**：产品统计、分类统计

## 二、部署步骤

### 1. 执行SQL文件

在数据库中执行 `sql/report_menu.sql` 文件，该文件将：
- 创建报表分析菜单（一级菜单：报表分析）
- 创建报表分析页面菜单（二级菜单：报表分析）
- 创建相关权限按钮
- 为管理员角色分配菜单权限

**执行命令：**
```sql
-- 在MySQL客户端或数据库管理工具中执行
source sql/report_menu.sql;
-- 或者直接复制SQL内容执行
```

### 2. 后端配置

后端模块已创建完成，包括：
- `ruoyi-report` 模块已添加到主 `pom.xml`
- `ruoyi-admin` 已添加 `ruoyi-report` 依赖
- Controller、Service、Mapper 已创建

**无需额外配置**，重启后端服务即可。

### 3. 前端配置

前端文件已创建完成：
- API文件：`RuoYi-Vue3/src/api/report/index.js`
- 页面文件：`RuoYi-Vue3/src/views/report/index.vue`

**无需额外配置**，前端路由由后端菜单动态生成。

### 4. 验证部署

1. 重启后端服务
2. 重新登录系统
3. 在左侧菜单中应该能看到"报表分析"菜单
4. 点击进入报表分析页面，查看数据是否正常加载

## 三、权限说明

### 权限标识列表

| 权限标识 | 说明 |
|---------|------|
| `report:dashboard:list` | 仪表盘查询权限 |
| `report:stock:list` | 库存统计查询权限 |
| `report:check:list` | 盘点分析查询权限 |
| `report:material:list` | 原料使用分析查询权限 |
| `report:product:list` | 产品分析查询权限 |

### 权限分配

- 管理员角色（role_id=1）已自动分配所有权限
- 如需为其他角色分配权限，可在角色管理中手动分配，或修改SQL文件中的 `sys_role_menu` 插入语句

## 四、菜单结构

```
报表分析 (2000) - 一级菜单
  └── 报表分析 (2001) - 二级菜单（页面）
      ├── 仪表盘查询 (2002) - 按钮权限
      ├── 库存统计查询 (2003) - 按钮权限
      ├── 库存预警查询 (2004) - 按钮权限
      ├── 盘点分析查询 (2005) - 按钮权限
      ├── 原料使用查询 (2006) - 按钮权限
      └── 产品分析查询 (2007) - 按钮权限
```

## 五、注意事项

1. **菜单ID冲突**：如果菜单ID 2000-2007 已被使用，请修改SQL文件中的菜单ID
2. **路由路径**：前端路由路径为 `/report/index`，由后端菜单配置自动生成
3. **数据依赖**：报表数据依赖于以下表：
   - `stock_info` - 库存信息表
   - `stock_check` - 盘点表
   - `warehouse` - 仓库表
   - `material_info` - 原料信息表
   - `product_info` - 产品信息表
   - `product_formula` - 产品配方表
4. **图标**：菜单图标使用 `chart`，如需修改可在菜单管理中更改

## 六、故障排查

### 问题1：菜单不显示
- 检查SQL是否执行成功
- 检查当前用户角色是否有菜单权限
- 清除浏览器缓存，重新登录

### 问题2：页面404错误
- 检查前端文件是否存在：`RuoYi-Vue3/src/views/report/index.vue`
- 检查菜单配置中的 `component` 路径是否正确：`report/index`

### 问题3：数据加载失败
- 检查后端服务是否正常启动
- 检查数据库表是否存在
- 查看后端日志，确认是否有SQL错误

### 问题4：权限不足
- 在角色管理中为当前角色分配报表分析相关权限
- 或执行SQL为角色分配权限

## 七、后续扩展

如需添加新的报表功能：
1. 在 `ReportController` 中添加新的接口
2. 在 `IReportService` 和 `ReportServiceImpl` 中实现业务逻辑
3. 在 `ReportMapper` 和 `ReportMapper.xml` 中添加SQL查询
4. 在前端API中添加对应的方法
5. 在前端页面中添加新的展示区域


