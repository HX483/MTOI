# 奶茶店订单制作与原料库存管理系统详细设计文档

## 1. 系统管理模块详细设计

### 1.1 用户管理
- **功能说明**：管理系统用户，包括添加、编辑、删除、查询等操作
- **核心类**：
  - UserController：处理用户相关请求
  - UserService：用户业务逻辑
  - UserMapper：用户数据访问
- **关键方法**：
  - addUser(User user)：添加用户
  - updateUser(User user)：更新用户信息
  - deleteUser(Long userId)：删除用户
  - getUserList(UserQuery query)：查询用户列表

### 1.2 角色权限管理
- **功能说明**：管理系统角色和权限，实现RBAC权限控制
- **核心类**：
  - RoleController：角色管理控制器
  - PermissionController：权限管理控制器
  - RoleService：角色业务逻辑
  - PermissionService：权限业务逻辑
- **关键方法**：
  - assignPermissions(Long roleId, List<Long> permissionIds)：分配权限
  - getUserRoles(Long userId)：获取用户角色
  - checkPermission(String permission)：权限校验

## 2. 订单管理模块详细设计

### 2.1 订单创建与管理
- **功能说明**：处理订单创建、状态更新、查询等操作
- **核心类**：
  - OrderController：订单管理控制器
  - OrderService：订单业务逻辑
  - OrderMapper：订单数据访问
  - OrderValidator：订单验证器
- **关键方法**：
  - createOrder(OrderDTO orderDTO)：创建订单
  - updateOrderStatus(Long orderId, OrderStatus status)：更新订单状态
  - getOrderById(Long orderId)：获取订单详情
  - getOrderList(OrderQuery query)：查询订单列表

### 2.2 订单制作流程管理
- **功能说明**：管理订单从接单到完成的整个制作流程
- **核心类**：
  - OrderProcessService：订单流程服务
  - NotificationService：通知服务
  - StockService：库存服务
- **关键方法**：
  - acceptOrder(Long orderId)：接单
  - startMaking(Long orderId)：开始制作
  - finishMaking(Long orderId)：完成制作
  - deliverOrder(Long orderId)：订单配送
  - completeOrder(Long orderId)：订单完成

## 3. 原料库存模块详细设计

### 3.1 原料信息管理
- **功能说明**：管理原料的基本信息，如名称、规格、单位等
- **核心类**：
  - MaterialController：原料管理控制器
  - MaterialService：原料业务逻辑
  - MaterialMapper：原料数据访问
- **关键方法**：
  - addMaterial(Material material)：添加原料
  - updateMaterial(Material material)：更新原料信息
  - deleteMaterial(Long materialId)：删除原料
  - getMaterialList(MaterialQuery query)：查询原料列表

### 3.2 库存管理
- **功能说明**：管理原料库存，包括入库、出库、盘点等操作
- **核心类**：
  - StockController：库存管理控制器
  - StockService：库存业务逻辑
  - StockMapper：库存数据访问
  - StockRecordService：库存记录服务
- **关键方法**：
  - stockIn(StockInDTO dto)：原料入库
  - stockOut(StockOutDTO dto)：原料出库
  - updateStockAlert(Long materialId, Integer alertValue)：设置库存预警
  - checkLowStock()：检查低库存
  - stockTake(StockTakeDTO dto)：库存盘点

## 4. 大模型应用模块详细设计

### 4.1 智能推荐功能
- **功能说明**：基于用户历史订单和偏好推荐个性化饮品
- **核心类**：
  - RecommendationController：推荐控制器
  - RecommendationService：推荐业务逻辑
  - AIService：AI接口服务
- **关键方法**：
  - getRecommendations(Long customerId, Integer limit)：获取推荐列表
  - trainModel()：模型训练
  - updateUserPreferences(Long customerId, List<Long> productIds)：更新用户偏好

### 4.2 智能客服功能
- **功能说明**：使用大模型处理常见订单咨询和问题
- **核心类**：
  - CustomerServiceController：客服控制器
  - CustomerServiceService：客服业务逻辑
  - AIService：AI接口服务
- **关键方法**：
  - chat(String question, Long userId)：智能问答
  - createTicket(CustomerTicket ticket)：创建工单
  - processTicket(Long ticketId, String solution)：处理工单

### 4.3 需求预测功能
- **功能说明**：预测未来销售趋势和原料需求
- **核心类**：
  - ForecastController：预测控制器
  - ForecastService：预测业务逻辑
  - AIService：AI接口服务
- **关键方法**：
  - forecastSales(Date startDate, Date endDate)：销售预测
  - forecastMaterialNeed(Date startDate, Date endDate)：原料需求预测
  - generateReplenishmentPlan()：生成补货计划

## 5. 报表分析模块详细设计

### 5.1 销售报表
- **功能说明**：生成各类销售统计报表
- **核心类**：
  - ReportController：报表控制器
  - SalesReportService：销售报表服务
- **关键方法**：
  - generateDailyReport(Date date)：生成日报
  - generateWeeklyReport(Date startDate, Date endDate)：生成周报
  - generateMonthlyReport(Integer year, Integer month)：生成月报
  - generateProductAnalysis(Date startDate, Date endDate)：产品销售分析

### 5.2 库存报表
- **功能说明**：生成库存相关统计报表
- **核心类**：
  - StockReportService：库存报表服务
- **关键方法**：
  - generateStockStatusReport()：库存状态报表
  - generateStockMovementReport(Date startDate, Date endDate)：库存变动报表
  - generateMaterialConsumptionReport(Date startDate, Date endDate)：原料消耗报表

## 6. 数据库详细设计

### 6.1 表结构设计

#### product_info表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| product_id | bigint | PRIMARY KEY | 产品ID |
| product_name | varchar(100) | NOT NULL | 产品名称 |
| category_id | bigint | FOREIGN KEY | 分类ID |
| price | decimal(10,2) | NOT NULL | 价格 |
| description | varchar(500) | | 产品描述 |
| status | tinyint | DEFAULT 1 | 状态(1:上架,0:下架) |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | NOT NULL | 更新时间 |

#### product_formula表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| formula_id | bigint | PRIMARY KEY | 配方ID |
| product_id | bigint | FOREIGN KEY | 产品ID |
| material_id | bigint | FOREIGN KEY | 原料ID |
| quantity | decimal(10,4) | NOT NULL | 用量 |
| unit | varchar(20) | NOT NULL | 单位 |

#### material_info表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| material_id | bigint | PRIMARY KEY | 原料ID |
| material_name | varchar(100) | NOT NULL | 原料名称 |
| category_id | bigint | FOREIGN KEY | 分类ID |
| specification | varchar(100) | | 规格 |
| unit | varchar(20) | NOT NULL | 单位 |
| supplier_id | bigint | FOREIGN KEY | 供应商ID |
| shelf_life | int | | 保质期(天) |
| status | tinyint | DEFAULT 1 | 状态(0:启用,1:禁用) |

#### stock_info表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| stock_id | bigint | PRIMARY KEY | 库存ID |
| material_id | bigint | UNIQUE NOT NULL | 原料ID |
| quantity | decimal(15,4) | NOT NULL | 库存数量 |
| alert_threshold | decimal(15,4) | NOT NULL | 预警阈值 |
| warehouse_id | bigint | FOREIGN KEY | 仓库ID |
| update_time | datetime | NOT NULL | 更新时间 |

#### order_main表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| order_id | bigint | PRIMARY KEY | 订单ID |
| order_no | varchar(50) | UNIQUE NOT NULL | 订单编号 |
| customer_id | bigint | | 顾客ID |
| total_amount | decimal(10,2) | NOT NULL | 总金额 |
| order_type | tinyint | NOT NULL | 订单类型(1:堂食,2:外卖,3:自提) |
| status | tinyint | NOT NULL | 订单状态 |
| payment_status | tinyint | NOT NULL | 支付状态 |
| create_time | datetime | NOT NULL | 创建时间 |
| update_time | datetime | NOT NULL | 更新时间 |
| remark | varchar(500) | | 备注 |

#### order_detail表
| 字段名 | 数据类型 | 约束 | 描述 |
| :--- | :--- | :--- | :--- |
| detail_id | bigint | PRIMARY KEY | 详情ID |
| order_id | bigint | FOREIGN KEY | 订单ID |
| product_id | bigint | FOREIGN KEY | 产品ID |
| quantity | int | NOT NULL | 数量 |
| price | decimal(10,2) | NOT NULL | 单价 |
| subtotal | decimal(10,2) | NOT NULL | 小计 |
| customization | varchar(500) | | 定制要求 |

## 7. 接口详细设计

### 7.1 订单接口

#### 创建订单
- **URL**: /api/order/create
- **Method**: POST
- **Request Body**:
  ```json
  {
    "customerId": 1,
    "orderType": 2,
    "items": [
      {
        "productId": 101,
        "quantity": 2,
        "customization": "少糖"
      }
    ],
    "remark": "尽快送达"
  }